<div class="row gx-16" style="margin-bottom:16px; padding:16px; border: 2px solid #1c1c1e; background-color: #1c1c1e; border-radius: 10px; width: 100%; box-sizing: border-box;">
  <div class="col-9">
    <h4 class="job-testType" style="color:rgb(120,120,120); margin-bottom:4px;">{{job['testType']}}</h4>
    <div class="job-client"><b>Client:</b> {{job['client']}}</div>
  </div>
  <div class="col-3">
    <div class="btn-group-vertical" role="group" aria-label="Vertical radio toggle button group">
      <button type="button" class="btn btn-outline-primary" data-job-id="{{job['id']}}" onclick="loadUpdateForm(this)">Update</button>
      <button type="button" class="btn btn-outline-success">Complete</button>
      <button type="button" class="btn btn-outline-danger" data-job-id="{{job['id']}}"  onclick="deleteJob(this)">Delete</button>
    </div>
  </div>
</div>

<script>
function deleteJob(button) {
    var jobId = button.getAttribute('data-job-id');
    console.log('conworking');
    fetch(`/delete-job/${jobId}`, {
        method: 'DELETE',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            // Debug: Log the response and the element being removed
            console.log('Delete successful:', data);
            console.log('Removing element:', button.closest('.row'));
            // Remove the job item from the DOM
            button.closest('.row').remove();
            console.log('Element removed:');
        } else {
            console.error('Server response error:', data.message);
            alert('Error: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Fetch error:', error);
        alert('An error occurred while deleting the job.');
    });
}
function loadUpdateForm(jobId) {
    var jobId = jobId.getAttribute('data-job-id');
    console.log(jobId)
    // Redirect to the route that renders the form with initial data
    fetch(`/get-job/${jobId}`, {
        method: 'GET',  // Use GET for retrieving data
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        console.log(data);
        if (data.status === 'success') {
            new bootstrap.Modal(document.querySelector("#updateJobModal")).show();
            // Set job ID in the hidden field
            document.querySelector('#jobId').value = jobId;
            const form = document.querySelector('#updateItemForm');
            form.action = `/update-job/${jobId}`;
            console.log("Form action URL set to:", form.action);
            document.querySelector('#updateJobModal #testType').value = data.testType || '';
            document.querySelector('#updateJobModal #client').value = data.client || '';
            document.querySelector('#updateJobModal #entity').value = data.entity || '';
            document.querySelector('#updateJobModal #assignedTo').value = data.assignedTo || '';
        } else {
            alert("Error retrieving job item");
        }
    })
    .catch(error => console.error('Error:', error));
    
}
function updateJob(jobId) {
    console.log("js working");

    var jobId = jobId.getAttribute('data-job-id');
    

    fetch(`/update-job/${jobId}`, {
        method: 'PUT',  // Changed to PUT
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            'refID': jobId
        })
    })
    .then(response => response.json())
    .then(data => {
        console.log(data);
        if (data.status === 'success') {
            alert("Item updated successfully");
        } else {
            alert("Error updating item");
        }
    })
    .catch(error => console.error('Error:', error));
}
</script>